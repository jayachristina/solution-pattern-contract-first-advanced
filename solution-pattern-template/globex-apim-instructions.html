<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: Solution Patterns for Cloud Native Architectures</title>
    <link rel="canonical" href="https://redhat-solution-patterns.github.io/solution-patterns/solution-pattern-template/globex-apim-instructions.html">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../_/css/site.css">
<link rel="icon" href="../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  </head>
  <body class="article">
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9TW8CJFT3N"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-9TW8CJFT3N');
</script>
<!-- Google tag (gtag.js) -->

<header class="header">
  <script type="text/javascript">
    document.addEventListener('DOMContentLoaded', function () { 
      const urlParams = new URLSearchParams(window.location.search);
      const userId = urlParams.get('USERID');
      const subdomain = urlParams.get('SUBDOMAIN'); 
      if (userId) {
        showUserId( userId, subdomain);
      }
      else {
        showUserIdForm(subdomain);
      }
    } );


    function showUserId( userId, subdomain) {
      document.getElementById('navbar-form-empty').style.display = "none";
      document.getElementById('navbar-form-filled').style.display = "flex";
      document.getElementById('userIdDisplay').textContent = "User ID : " + userId;
      document.getElementById('subdomainDisplay').textContent = "Subdomain : " + subdomain; 
    }

    function showUserIdForm( subdomain ) {
      document.getElementById('navbar-form-empty').style.display = "flex";
      document.getElementById('navbar-form-filled').style.display = "none";
      document.getElementById('subdomain').value = subdomain; 

    }

    function goWithUserId() {
      elUserIdInput = document.getElementById('userId');
      elSubdomainInput = document.getElementById('subdomain');
      window.location.search = ('&USERID=' + elUserIdInput.value  + '&SUBDOMAIN=' + elSubdomainInput.value);
    }

    function recycle() {
      document.getElementById('userId').value='';
      document.getElementById('subdomain').value='';
      window.location.search = ('');
    }


  </script>
  <nav class="navbar">
   <div class="navbar-brand">
      <a class="navbar-item" style="font-size: 20px; color: white" href="https://redhat-solution-patterns.github.io/solution-patterns">
        <img src="../_/img/logo.png" height="35px" alt="Solution Patterns">&nbsp; Solution Patterns for Cloud Native Architectures</a>
      <button class="navbar-burger" data-target="topbar-nav">
      </button>
      
    </div>
    <div class="navbar-item" ><span class="navbar-text" style="color: white; margin-left: 1rem; margin-right: 1rem;">|</span></div>
    
    <div class="navbar-item has-dropdown is-hoverable" >
      <a class="navbar-link" href="#" style="color: white">Red Hat Patterns</a>
      <div class="navbar-dropdown">
        <a class="navbar-item" href="https://www.redhat.com/architect/portfolio/" target="_blank">Portfolio Architecture&nbsp; </a>
        <a class="navbar-item" href="https://redhat-solution-patterns.github.io/solution-patterns/patterns.html" target="_blank">Solution Patterns </a>
        <a class="navbar-item" href="https://validatedpatterns.io/" target="_blank">Validated Patterns&nbsp;</a>

      </div>
    </div>
    <div class="navbar-item has-dropdown is-hoverable" >
      <a class="navbar-link" href="#" style="color: white">Resources</a>
      <div class="navbar-dropdown">
        <a class="navbar-item" target="_blank" href="https://www.redhat.com/en/products/application-foundations">Red Hat Application Services</a>
        <a class="navbar-item" target="_blank" href="https://developers.redhat.com/app-dev-platform">App Dev Platform</a>
      </div>
    </div>

    <div class="navbar-item" ><span class="navbar-text" style="color: white; margin-left: 1rem; margin-right: 1rem;">|</span></div>


    

    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        


        <div class="navbar-item" id="navbar-form-empty">
          <span class="navbar-text" style="margin-left: 2rem;">
          <span class="navbar-text" style="margin-left: 1rem; margin-right: 1rem;">&nbsp;<i style="color: orange;"
              class="fa fa-exclamation-triangle" aria-hidden="true"></i></span>
            Your Workshop Environment

          <form action="javascript:void(0);" onsu>
            <input size="20" id="userId" type="text" placeholder="USER ID">
            <input size="20" id="subdomain" type="text" placeholder="Subdomain">
            <button type="hidden" onclick="goWithUserId();">Set</button>
          </form>
        </div>
        
        <div class="navbar-item" id="navbar-form-filled" style="display: none;">
          <span class="navbar-text" style="margin-left: 2rem;">
          <span class="navbar-text " style="margin-left: 1rem; margin-right: 1rem; float:left">
            &nbsp;Your Workshop Environment <span class="navbar-text" style="margin-left: 1rem; margin-right: 1rem;">&nbsp;<i alt="Clear details" title="Clear details" onclick="recycle();" style="color: green;" class="fa fa-recycle" aria-hidden="true"></i>

          <br><span  id="userIdDisplay"></span> <span  style="color: white; margin-left: 1rem; margin-right: 1rem;">|</span>
          <span id="subdomainDisplay"></span>
        </div>

        
        </span>

    </div>
  </nav>
</header><div class="body">
<div class="nav-container" data-component="solution-pattern-template" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html" class=" query-params-link">Contract First approach - Advanced with OIDC</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">1. Home page</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#use-cases">1.1 Use cases</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#01-pattern.adoc#_the_story_behind_this_solution_pattern">1.2 The story behind this solution pattern</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#01-pattern.adoc#_the_solution">1.3 The solution</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#_content_overview">1.4 Content Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#_content_overview">1.5 Explore more solution patterns</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="02-architecture.html">2. Architecture</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-architecture.html#tech_stack">2.1. Technology stack</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-architecture.html#in_depth">2.2. An in-depth look at the solution&#8217;s architecture</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-architecture.html#tech_stack">2.3. More about the technology stack</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="03-demo.html">3. Solution in Action</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-demo.html#_demonstration">3.1. Demonstration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="03-demo.html#_run_the_demonstration">3.2. Run this demonstration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="03-demo.html#_before_getting_started">3.3. Pre-requisites</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="03-demo.html#_installing_the_demo">3.4. Installing the demo</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="03-demo.html#_walkthrough_guide">3.5. Walkthrough guide</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="developer-resources.html">4. Developer Resources</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="#05-appendix.adoc">5. Appendix</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="https://redhat-solution-patterns.github.io/">Other Red Hat Solution Patterns</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Contract First approach - Advanced with OIDC</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Contract First approach - Advanced with OIDC</span>
      <ul class="versions">
        <li class="version is-current">
          <a href="index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
</nav>
  <div class="edit-this-page"><a href="https://github.com/jayachristina/solution-pattern-contract-first-advanced/edit/main/documentation/modules/ROOT/pages/globex-apim-instructions.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_objectives">1. Objectives</a></li>
<li><a href="#_setup_openshift_dev_spaces">2. Setup OpenShift Dev Spaces</a>
<ul class="sectlevel2">
<li><a href="#_section_goals">2.1. Section Goals</a></li>
<li><a href="#_instructions">2.2. Instructions</a></li>
<li><a href="#_scratchpad">2.3. Scratchpad</a></li>
</ul>
</li>
<li><a href="#_red_hat_sso_an_introduction">3. Red Hat SSO - An Introduction</a></li>
<li><a href="#_design_and_govern_mobile_openapi_specification">4. Design and Govern Mobile OpenAPI Specification</a>
<ul class="sectlevel2">
<li><a href="#_section_goals_2">4.1. Section Goals</a></li>
<li><a href="#_design_mobile_openapi">4.2. Design Mobile OpenAPI</a></li>
<li><a href="#_manage_the_mobile_openapi_with_service_registry">4.3. Manage the Mobile OpenAPI with Service Registry</a></li>
<li><a href="#_section_outcome">4.4. Section Outcome</a></li>
<li><a href="#_cleanup">4.5. Cleanup</a></li>
</ul>
</li>
<li><a href="#_configure_3scale_api_management_to_secure_and_manage_mobile_gateway_api">5. Configure 3scale API Management to secure and manage Mobile Gateway API</a>
<ul class="sectlevel2">
<li><a href="#_section_goals_3">5.1. Section Goals</a></li>
<li><a href="#_red_hat_sso">5.2. Red Hat SSO</a></li>
<li><a href="#_create_mobile_gateway_backend_product_and_activedoc_on_3scale">5.3. Create Mobile Gateway Backend, Product and ActiveDoc on 3scale</a></li>
<li><a href="#_setup_mobile_users">5.4. Setup Mobile users</a></li>
<li><a href="#_view_the_newly_created_backend_product_activedoc_and_users">5.5. View the newly created Backend, Product, ActiveDoc and Users</a></li>
<li><a href="#_setup_globex_dev_portal">5.6. Setup Globex Dev Portal</a></li>
<li><a href="#_sign_up_as_a_mobile_developer">5.7. Sign up as a Mobile Developer</a></li>
<li><a href="#_section_outcome_2">5.8. Section Outcome</a></li>
</ul>
</li>
<li><a href="#_test_mobile_application">6. Test Mobile Application</a>
<ul class="sectlevel2">
<li><a href="#_analytics">6.1. Analytics</a></li>
<li><a href="#_under_the_hood">6.2. Under the hood</a></li>
<li><a href="#_cleanup_2">6.3. Cleanup</a></li>
</ul>
</li>
<li><a href="#_setup_partner_gateway_and_partner_web_app_optional">7. Setup Partner Gateway and Partner Web App (Optional)</a>
<ul class="sectlevel2">
<li><a href="#_publish_partner_api_to_service_registry">7.1. Publish Partner API to Service Registry</a></li>
<li><a href="#_create_backend_products_activedoc_and_users_for_partner_gateway">7.2. Create Backend, Products, ActiveDoc and Users for Partner Gateway</a></li>
<li><a href="#_create_active_doc_for_partner_gateway">7.3. Create Active Doc for Partner Gateway</a></li>
<li><a href="#_setup_partner_users">7.4. Setup Partner users</a></li>
<li><a href="#_configurations_on_3scale_admin_console">7.5. Configurations on 3scale admin console</a></li>
<li><a href="#_signup_for_an_application_as_a_partner">7.6. Signup for an application as a Partner</a></li>
<li><a href="#_setup_partner_web_portal">7.7. Setup Partner Web Portal</a></li>
</ul>
</li>
<li><a href="#_test_partner_web_application">8. Test Partner Web Application</a>
<ul class="sectlevel2">
<li><a href="#_analytics_2">8.1. Analytics</a></li>
<li><a href="#_under_the_hood_2">8.2. Under the hood</a></li>
</ul>
</li>
<li><a href="#_congratulations">9. Congratulations</a></li>
</ul>
</div>
<div class="sect1">
<h2 id="_objectives"><a class="anchor" href="#_objectives"></a>1. Objectives</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Here is an outline of the activities you will achieve as part of this module.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/apim-overview-flowchart.png" alt="apim overview flowchart">
</div>
<div class="title">Figure 1. Activities overview</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_setup_openshift_dev_spaces"><a class="anchor" href="#_setup_openshift_dev_spaces"></a>2. Setup OpenShift Dev Spaces</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You are going to use <strong>OpenShift Dev Spaces</strong> for a number of activities. OpenShift Dev Spaces uses Kubernetes and containers to provide a consistent, secure, and zero-configuration development environment, accessible from a browser window.</p>
</div>
<div class="sect2">
<h3 id="_section_goals"><a class="anchor" href="#_section_goals"></a>2.1. Section Goals</h3>
<div class="ulist">
<ul>
<li>
<p>Access OpenShift Dev Spaces as <strong>%user_name%</strong></p>
</li>
<li>
<p>Ensure you are logged in to OpenShift as <strong>%user_name%</strong></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_instructions"><a class="anchor" href="#_instructions"></a>2.2. Instructions</h3>
<div class="ulist">
<ul>
<li>
<p>In a browser window, navigate to the browser tab pointing to the Developer perspective of the OpenShift cluster. If you don&#8217;t have a browser tab open on the console, click on %openshift_cluster_console%[OpenShift Console^, window="console"] to launch the console. If needed login with your username and password (%user_name%/%user_password%).</p>
</li>
<li>
<p>On the top menu of the console, click on the <span class="image unresolved"><img src="openshift-application-menu.png" alt="openshift application menu"></span> icon, and in the drop-down box, select <strong>Red Hat OpenShift Dev Spaces</strong>.</p>
<div class="imageblock unresolved">
<div class="content">
<img src="openshift-application-menu-2.png" alt="openshift application menu 2">
</div>
<div class="title">Figure 2. Access Red Hat Devspace</div>
</div>
</li>
<li>
<p>Login in with your OpenShift credentials (%user_name%/%user_password%). If this is the first time you access Dev Spaces, you have to authorize Dev Spaces to access your account. In the <em>Authorize Access</em> window click on <strong>Allow selected permissions</strong>.</p>
<div class="imageblock unresolved">
<div class="content">
<img src="devspace-auth-access.png" alt="devspace auth access" width="70%">
</div>
<div class="title">Figure 3. Red Hat Devspace - Allow selected permissions</div>
</div>
</li>
<li>
<p>You are directed to the Dev Spaces overview page, which shows the workspaces you have access to. You should see a single workspace, called <strong>cloud-architecture-workshop</strong>. The workspace needs a couple of seconds to start up.</p>
<div class="imageblock unresolved">
<div class="content">
<img src="devspaces-workspace-starting.png" alt="devspaces workspace starting">
</div>
<div class="title">Figure 4. Red Hat Devspace - cloud-architecture-workshop</div>
</div>
</li>
<li>
<p>Click on the <strong>Open</strong> link of the workspace.</p>
<div class="imageblock unresolved">
<div class="content">
<img src="devspaces-workspace-started-1.png" alt="devspaces workspace started 1">
</div>
<div class="title">Figure 5. Red Hat Devspace - Open cloud-architecture-workshop</div>
</div>
</li>
<li>
<p>This opens the workspace, which will look pretty familiar if you are used to working with VS Code. Before opening the workspace, a pop-up might appear asking if you trust the contents of the workspace. Click <strong>Yes, I trust the authors</strong> to continue.</p>
<div class="imageblock unresolved">
<div class="content">
<img src="devspaces-trust-contents.png" alt="devspaces trust contents">
</div>
<div class="title">Figure 6. Red Hat Devspace - Agree to trust the authors</div>
</div>
</li>
<li>
<p>The workspace contains all the resources you are going to use during the workshop. In the project explorer on the left of the workspace, open the <strong>workshop/module-apim</strong> folder as shown in the screenshot below</p>
<div class="imageblock">
<div class="content">
<img src="_images/apim-devspaces.png" alt="apim devspaces">
</div>
<div class="title">Figure 7. Red Hat Devspace - API Module</div>
</div>
</li>
<li>
<p>You can deploy the various resources needed in this workshop to the OpenShift cluster directly from Dev Spaces. To do so, you will need access to the built-in <strong>Terminal</strong>. Click on the <span class="image unresolved"><img src="devspaces-menu.png" alt="devspaces menu"></span> icon on the top of the left menu, and select <strong>Terminal &#8594; New Terminal</strong> from the drop-down menu.</p>
<div class="imageblock">
<div class="content">
<img src="_images/apim-devspaces-menu-new-terminal.png" alt="apim devspaces menu new terminal">
</div>
<div class="title">Figure 8. Red Hat Devspace - New terminal</div>
</div>
</li>
<li>
<p>This opens a terminal in the bottom half of the workspace.</p>
<div class="imageblock">
<div class="content">
<img src="_images/apim-devspaces-menu-terminal.png" alt="apim devspaces menu terminal">
</div>
<div class="title">Figure 9. Red Hat Devspace - Open terminal</div>
</div>
</li>
<li>
<p>The OpenShift Dev Spaces environment has access to a plethora of command line tools, including <strong>oc</strong>, the OpenShift command line interface. Through OpenShift Dev Spaces you are automatically logged in into the OpenShift cluster. You can verify this with the command <strong>oc whoami</strong>.</p>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc whoami</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Output</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">%user_name%</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the output of the <code>oc whoami</code> command does not correspond to your username (%user_name%), you need to logout and login again with the correct username.</p>
</div>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc logout
oc login -u %user_name% -p %user_password% %openshift_api_internal%</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>You will be working in the <code>globex-apim-%user_name%</code> namespace. So run this following command to start using that particular project</p>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc project globex-apim-%user_name%</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/apim-terminal-setup.png" alt="apim terminal setup" width="70%">
</div>
<div class="title">Figure 10. Red Hat Devspace - Verify that you are using the globex-apim-&lt;username&gt; namespace</div>
</div>
</li>
<li>
<p>Keep this browser tab open because you will referring to draft content, scripts and YAML files for creating objects on OpenShift</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_scratchpad"><a class="anchor" href="#_scratchpad"></a>2.3. Scratchpad</h3>
<div class="paragraph">
<p>As you work through this Contract First APIs module, there are a few variables and URLs that are needed throughout this activity. To make things easier and manageable we&#8217;ve setup a scratchpad within Dev Spaces. You can fill this scratchpad up with information needed as you are guided below so that you can progress through this activity faster.</p>
</div>
<div class="paragraph">
<p><br></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_red_hat_sso_an_introduction"><a class="anchor" href="#_red_hat_sso_an_introduction"></a>3. Red Hat SSO - An Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Red Hat SSO is used in this module to both offer single-sign on to Mobile users, and also for securing the APIs.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>We will be using OpenID Connect which is an open authentication protocol that works on top of the OAuth 2.0 framework. OIDC offers a discovery mechanism called <strong>OpenID Connect Discovery</strong>, where an OpenID server (here Red Hat SSO based on Keycloak) publishes its metadata at a well-known URL. This URL is typically a collection of various endpoints the server offers, some of which are used in this workshop too.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Launch Red Hat SSO by clicking %sso_tenant_console%[SSO Console^,window="sso"] and login using username and password (%user_name%/%user_password%).</p>
</li>
<li>
<p>Click on the <strong>OpenID Endpoint Configuration</strong> link to view the <strong>OpenID Provider Configuration</strong> of Red Hat SSO.</p>
<div class="imageblock">
<div class="content">
<img src="_images/apim-sso-login.png" alt="apim sso login">
</div>
<div class="title">Figure 11. Red Hat SSO - Logged In</div>
</div>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In case you see an error stating <strong>You don&#8217;t have access to the requested resource</strong>, you will need to logout, close the browser tab, and login again</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Click on <strong>Sign Out</strong> and close the browser</p>
</li>
<li>
<p>Launch Red Hat SSO by clicking %sso_tenant_console%[SSO Console^,window="sso"] and login using username and password (%user_name%/%user_password%).</p>
</li>
<li>
<p>Login as <strong>(%user_name%/%user_password%)</strong>.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Here is how the <strong>OpenID Provider Configuration</strong> looks like</p>
<div class="imageblock">
<div class="content">
<img src="_images/well-know-openid-configuration.png" alt="well know openid configuration">
</div>
<div class="title">Figure 12. Red Hat SSO - OpenID Provider Configuration</div>
</div>
</li>
<li>
<p>We are interested specifically in the following endpoints</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Endpoint</th>
<th class="tableblock halign-left valign-top">URL</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>OpenID Provider Configuration (well-known config)</strong>:<br>
This URL provides a mechanism to discover the End-User&#8217;s OpenID Provider and obtain information needed to interact with it, including OpenID/OAuth endpoint locations. The following endpoints is fetched from this URL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://sso.%openshift_subdomain%/auth/realms/globex-%user_name%/.well-known/openid-configuration" class="bare">https://sso.%openshift_subdomain%/auth/realms/globex-%user_name%/.well-known/openid-configuration</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>issuer</strong>:<br>
This value is needed when we need to authorize a user through single sign-on</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://sso.%openshift_subdomain%/auth/realms/globex-%user_name%" class="bare">https://sso.%openshift_subdomain%/auth/realms/globex-%user_name%</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>token_endpoint</strong> :<br>
clients can obtain access tokens from the server using this token endpoint and use these same tokens to access protected resources (APIs in our case)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://sso.%openshift_subdomain%/auth/realms/globex-%user_name%/protocol/openid-connect/token" class="bare">https://sso.%openshift_subdomain%/auth/realms/globex-%user_name%/protocol/openid-connect/token</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><br></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_design_and_govern_mobile_openapi_specification"><a class="anchor" href="#_design_and_govern_mobile_openapi_specification"></a>4. Design and Govern Mobile OpenAPI Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this step you will import the draft OpenAPI specs for <strong>Mobile App</strong> and edit them to include <strong>Security Schemes</strong>. Once the API design phase is complete you will then manage that within the Red Hat Service Registry. The API Designer sessions are stateless and you must save your API definition as a JSON file at the end of each session.</p>
</div>
<div class="sect2">
<h3 id="_section_goals_2"><a class="anchor" href="#_section_goals_2"></a>4.1. Section Goals</h3>
<div class="ulist">
<ul>
<li>
<p>Import a draft OpenAPI specification for Mobile App into an API Designer</p>
</li>
<li>
<p>Edit the draft OpenAPI specification to add <strong>OpenID Security Schemes</strong> and include Red Hat SSO&#8217;s OpenID Provider Configuration</p>
</li>
<li>
<p>Govern the Mobile OpenAPI with Red Hat Service Registry</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_design_mobile_openapi"><a class="anchor" href="#_design_mobile_openapi"></a>4.2. Design Mobile OpenAPI</h3>
<div class="paragraph">
<p>To import the OpenAPI draft into API designer, you can import as text OR upload as file. To keep things simple in this workshop, you will import the content by simply pasting the draft spec as YAML based text into the API designer.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In a real-world scenario you would do the inverse: start with an empty API specification, and define the different elements of the spec document. You would then export the spec in JSON or YAML format (by copying the contents from the source editor) to your local file system and push it to version control.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Launch API Designer by clicking on this link %api_designer_url%[API Designer^, window=api_designer]</p>
</li>
<li>
<p>Click on the <strong>New API</strong> button.</p>
<div class="imageblock">
<div class="content">
<img src="_images/api-designer.png" alt="api designer">
</div>
<div class="title">Figure 13. Red Hat API Designer - New API</div>
</div>
</li>
<li>
<p>Click on the <strong>Source Tab</strong> on the <strong>New API</strong> page, and delete the entire content in the window.</p>
<div class="ulist">
<ul>
<li>
<p>Note: Keep this tab open. You will be pasting the draft OpenAPI into this window.</p>
<div class="imageblock">
<div class="content">
<img src="_images/api-new-api.png" alt="api new api">
</div>
<div class="title">Figure 14. API Designer - Open Source Tab</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/api-desginer-clear.png" alt="api desginer clear">
</div>
<div class="title">Figure 15. API Designer: Clear all content in Source Tab</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>To get the Mobile OpenAPI draft, navigate to the browser tab with <strong>Dev Spaces</strong> that you have earlier opened.</p>
<div class="ulist">
<ul>
<li>
<p>If you don&#8217;t have a browser tab open to Dev Spaces, click on %devspaces_dashboard%/dashboard/#/ide/devspaces-%user_name%/cloud-architecture-workshop[Dev Spaces IDE^, window="devspaces"]. If needed login with your username and password (%user_name%/%user_password%).</p>
</li>
</ul>
</div>
</li>
<li>
<p>In Dev Spaces, navigate to the folder <code>workshop &#8594; module-apim &#8594; mobile &#8594; activedoc</code>, and open the file <code>mobile-activedoc-draft.yaml</code></p>
<div class="ulist">
<ul>
<li>
<p>Or type [Ctrl+P] and type the file name as <code>mobile-activedoc-draft.yaml</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Copy the entire contents from this file <code>(Ctrl+A and Ctrl+C)</code></p>
<div class="imageblock">
<div class="content">
<img src="_images/mobile-draft-spec-devspace.png" alt="mobile draft spec devspace">
</div>
<div class="title">Figure 16. Copy Mobile OpenAPI draft from Dev spaces</div>
</div>
</li>
<li>
<p>Now paste the copied content (draft OpenAPI) from the above step into the API designer&#8217;s <strong>Source Tab</strong> replacing all of the existing content. Click on <strong>Save</strong> button as highlighted in the screenshot below.</p>
<div class="imageblock">
<div class="content">
<img src="_images/mobile-draft-imported.png" alt="mobile draft imported">
</div>
<div class="title">Figure 17. API Designer: Paste Mobile Draft OpenAPI</div>
</div>
</li>
<li>
<p>Navigate back to the <strong>Design Tab</strong></p>
<div class="imageblock">
<div class="content">
<img src="_images/api-design-tab.png" alt="api design tab">
</div>
<div class="title">Figure 18. API Designer: Design Tab</div>
</div>
</li>
<li>
<p>You will now need to update the security scheme. Under the <strong>SECURITY SCHEMES</strong> section, click on <strong>Add a security scheme</strong> link</p>
<div class="imageblock">
<div class="content">
<img src="_images/api-designer-sec-scheme.png" alt="api designer sec scheme">
</div>
<div class="title">Figure 19. API Designer: Add a security scheme</div>
</div>
</li>
<li>
<p>You are presented with the <strong>Define the Security Scheme</strong> page. Provide the following values in the form, and click on <strong>Save</strong></p>
<div class="ulist">
<ul>
<li>
<p>Name (textbox)</p>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">openid-connect</code></pre>
</div>
</div>
</li>
<li>
<p>Description (textarea)</p>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">OpenID Connect security scheme</code></pre>
</div>
</div>
</li>
<li>
<p>Security Type (dropdown)</p>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">OpenID Connect</code></pre>
</div>
</div>
</li>
<li>
<p>OpenID Connect URL (textbox)</p>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">https://sso.%openshift_subdomain%/auth/realms/globex-%user_name%/.well-known/openid-configuration</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/define-security-scheme.png" alt="define security scheme" width="90%">
</div>
<div class="title">Figure 20. API Designer: Define the Security Scheme wizard</div>
</div>
<div class="ulist">
<ul>
<li>
<p>You are navigated back to the homepage. Verify that you can see the <strong>SECURITY SCHEMES</strong> has been updated with your configuration</p>
<div class="imageblock">
<div class="content">
<img src="_images/security-scheme-complete.png" alt="security scheme complete">
</div>
<div class="title">Figure 21. API Designer: Verify openid-connect Security Scheme added</div>
</div>
</li>
<li>
<p>The OpenAPI specification is now ready to be downloaded. Click on the <em>down arrow</em> button adjacent to <strong>Save As..</strong> and then choose <strong>Save as YAML</strong> button found on top-right of the page. The file gets saved automatically in the <strong>Downloads folder</strong> of your computer.</p>
<div class="imageblock">
<div class="content">
<img src="_images/api-download-as-yaml.png" alt="api download as yaml">
</div>
<div class="title">Figure 22. API Designer: Save API as YAML in your computer</div>
</div>
</li>
<li>
<p>You can now close this browser tab.</p>
</li>
<li>
<p>The Mobile OpenAPI spec is ready to be governed with a Service Registry.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><br></p>
</div>
</div>
<div class="sect2">
<h3 id="_manage_the_mobile_openapi_with_service_registry"><a class="anchor" href="#_manage_the_mobile_openapi_with_service_registry"></a>4.3. Manage the Mobile OpenAPI with Service Registry</h3>
<div class="ulist">
<ul>
<li>
<p>Launch <strong>Service Registry</strong> by accessing %service_registry_url%[Service Registry^, window="service_registry_url"]</p>
<div class="imageblock">
<div class="content">
<img src="_images/service-registry-landing.png" alt="service registry landing">
</div>
<div class="title">Figure 23. Service Registry: Landing Page</div>
</div>
</li>
<li>
<p>Click on the <strong>Upload artifact</strong> button as shown in the above screenshot. You will be presented with a <strong>Upload Artifact</strong> wizard</p>
<div class="imageblock">
<div class="content">
<img src="_images/sr-upload-artifact.png" alt="sr upload artifact">
</div>
<div class="title">Figure 24. Service Registry: <strong>Upload Artifact</strong> wizard</div>
</div>
</li>
<li>
<p>In the wizard, enter the following details, and click on the <strong>Upload</strong> button.</p>
<div class="ulist">
<ul>
<li>
<p>Use the exact same values as instructed below to avoid errors in the other sections of this labs.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 71.4286%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Group</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>globex</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ID of the artifact</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mobileapi</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Artifact textarea</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Click on <strong>Browse..</strong> button to upload the Mobile OpenAPI downloaded in the previous step, or <code>Drag &amp; drop</code> the file into the textarea.</p></td>
</tr>
</tbody>
</table>
<div class="imageblock">
<div class="content">
<img src="_images/sr-spec-setting.png" alt="sr spec setting">
</div>
<div class="title">Figure 25. Service Registry: Provide information needed by <strong>Upload Artifact</strong> wizard and <strong>Upload</strong></div>
</div>
<div class="ulist">
<ul>
<li>
<p>Note that the <strong>Globex Mobile API Gateway</strong> artifact has been uploaded and stored within <strong>Service Registry</strong></p>
<div class="imageblock">
<div class="content">
<img src="_images/sr-uploaded.png" alt="sr uploaded">
</div>
<div class="title">Figure 26. Service Registry: <strong>Globex Mobile API Gateway</strong> artifact has been uploaded</div>
</div>
</li>
<li>
<p>You can share this OpenAPI schema with others via this OpenAPI Schema&#8217;s endpoint : %service_registry_url%/apis/registry/v2/groups/globex/artifacts/mobileapi</p>
</li>
<li>
<p>You can now close the Service Registry&#8217;s browser tab.</p>
</li>
<li>
<p>This schema can be used for generating Quarkus code for both Clients and Server-side using maven plugins. (Note that the <a href="https://github.com/rh-cloud-architecture-workshop/globex-mobile" target="code-samples">Globex Mobile App</a> is NodeJS + Angular in this module)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_section_outcome"><a class="anchor" href="#_section_outcome"></a>4.4. Section Outcome</h3>
<div class="ulist">
<ul>
<li>
<p>Added Security Scheme to Mobile OpenAPI with API Desginers</p>
</li>
<li>
<p>Imported the Mobile OpenAPI into Service Registry to govern the API spec.</p>
</li>
<li>
<p>A shareable link is available to the Mobile OpenAPI specification to be used by other teams and systems.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_cleanup"><a class="anchor" href="#_cleanup"></a>4.5. Cleanup</h3>
<div class="paragraph">
<p>Please close the API Designer and Service Registry browser tabs (^â€¿^) to avoid too many browser tabs</p>
</div>
<div class="paragraph">
<p><br></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configure_3scale_api_management_to_secure_and_manage_mobile_gateway_api"><a class="anchor" href="#_configure_3scale_api_management_to_secure_and_manage_mobile_gateway_api"></a>5. Configure 3scale API Management to secure and manage Mobile Gateway API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Mobile API has now been designed by API Designer, and is governed by Red Hat Service Registry.</p>
</div>
<div class="paragraph">
<p>Let us fast forward a bit in time, and the backend developers team has built the Mobile Gateway server-side <a href="https://github.com/rh-cloud-architecture-workshop/globex-mobile-gateway" target="code-samples">code</a> built using Quarkus. This service has been pre-deployed under the <code>module-apim-%user_name%</code> namespace on OpenShift.</p>
</div>
<div class="paragraph">
<p>In this section you will manage and secure the Mobile Gateway API endpoints so that the Mobile App can access them securely. To create these API endpoints, and secure and manage them, we will need to configure them on 3scale API management.</p>
</div>
<div class="sect2">
<h3 id="_section_goals_3"><a class="anchor" href="#_section_goals_3"></a>5.1. Section Goals</h3>
<div class="ulist">
<ul>
<li>
<p>setup Red Hat SSO to provide single sign-on (SSO) capabilities for users signing into Mobile App</p>
</li>
<li>
<p>setup Red Hat SSO to secure Mobile Gateway API endpoints using OpenID Connect</p>
</li>
<li>
<p>manage Mobile Gateway APIs with Red Hat 3scale API Management</p>
</li>
<li>
<p>access Red Hat 3scale API Management&#8217;s Developer Portal as a Mobile Developer to sign up for access of API</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_red_hat_sso"><a class="anchor" href="#_red_hat_sso"></a>5.2. Red Hat SSO</h3>
<div class="paragraph">
<p>3scale integrates with Red Hat SSO for authenticating the API requests using the OpenID Connect specification. On signing-up, External/Mobile developers  will be provided with client credentialsto access to the APIs securely. This client credentials is synced between 3scale and the Red Hat Single Sign-On server using a component know an <strong>Zync</strong></p>
</div>
<div class="paragraph">
<p>In order to setup OpenID Connect, you will now create a special <strong>client id</strong> meant for <strong>Client Credentials Management</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Click to launch %sso_tenant_console%[Red Hat SSO^, window="sso"] and login using username and password (%user_name%/%user_password%).</p>
</li>
<li>
<p>Click on <strong>Clients</strong> from the left-hand navigation. And, then click on the <strong>Create</strong> button on the right side as shown below</p>
<div class="imageblock">
<div class="content">
<img src="_images/client-add.png" alt="client add">
</div>
<div class="title">Figure 27. Red Hat SSO: Clients listing</div>
</div>
</li>
<li>
<p>In the <strong>Add Client</strong> wizard, enter the following details, and click on the <strong>Save</strong> button.</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all" style="width: 60%;">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client Id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>client-manager</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client Protocol (dropdown)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>openid-connect</code></p></td>
</tr>
</tbody>
</table>
<div class="imageblock">
<div class="content">
<img src="_images/client-manager.png" alt="client manager">
</div>
<div class="title">Figure 28. Red Hat SSO: Add Client wizard</div>
</div>
<div class="ulist">
<ul>
<li>
<p>You will be shown the <strong>Settings</strong> tab of <code>client-manager</code> client.</p>
<div class="imageblock">
<div class="content">
<img src="_images/new-client-save.png" alt="new client save">
</div>
<div class="title">Figure 29. Red Hat SSO: View <strong>client-manager</strong> Settings</div>
</div>
</li>
<li>
<p>Configure this <code>client-manager</code> as follows (refer to screenshot below) so that 3scale can synchronize with Red Hat SSO</p>
<div class="ulist">
<ul>
<li>
<p>Change <strong>Access Type</strong> to <code>Confidential</code></p>
</li>
<li>
<p>Once the Access Types is Confidential you will see a new toggle button <strong>Service Accounts Enabled</strong></p>
</li>
<li>
<p>Keep <strong>Service Accounts Enabled</strong> as ON, and turn all other Grants and Flow OFF to match the following screenshot.</p>
<div class="paragraph">
<p>This configuration allows only Services based access using Service Accounts, and will be used by 3scale API Management system in the next steps, when mobile users sign up for access. Service accounts provide a flexible way to control API access without sharing a regular user&#8217;s credentials.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/client-manager-setting.png" alt="client manager setting">
</div>
<div class="title">Figure 30. Red Hat SSO: Configure client-manager</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Click on <strong>Save</strong> button at the bottom of the page. You will be notified that the changes are saved successfully.<br></p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/client-manager-save.png" alt="client manager save">
</div>
<div class="title">Figure 31. Red Hat SSO: Save client-manager settings</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Now you will need to setup <strong>Client Roles</strong> for this client id, so that it can manage other clients (create, amend and delete) on behalf of 3scale API Management</p>
<div class="ulist">
<ul>
<li>
<p>Click on the <strong>Service Account Roles</strong> tab from the top tab navigation.</p>
</li>
<li>
<p>From the <strong>Client Roles</strong> dropdown, choose <code>realm-management</code></p>
<div class="imageblock">
<div class="content">
<img src="_images/sso-service-acc-tab.png" alt="sso service acc tab">
</div>
<div class="title">Figure 32. Red Hat SSO: setup Service Account Roles for <strong>client-manager</strong> in Service Account Roles tab</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>From the <strong>Available Roles</strong> multichoice field, choose <code>manage-clients</code>, and click on <strong>Add selected &gt;&gt;</strong> button</p>
<div class="ulist">
<ul>
<li>
<p>The mappings will get auto-saved.</p>
<div class="imageblock">
<div class="content">
<img src="_images/client-realm-management.png" alt="client realm management">
</div>
<div class="title">Figure 33. Red Hat SSO: Add manage-clients roles</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>You can view the credentials of this client-id from the <strong>Credentials</strong> tab. You will need this when setting up the 3scale products<br></p>
<div class="ulist">
<ul>
<li>
<p>Now is a good time to save this in your Dev Spaces Scratchpad. (Ctrl+P &gt; scratchpad.txt to open the file from within Dev Spaces tab)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/client-manager-credentials.png" alt="client manager credentials">
</div>
<div class="title">Figure 34. Red Hat SSO: Client Credentials of client-manager</div>
</div>
</div>
<div class="sect2">
<h3 id="_create_mobile_gateway_backend_product_and_activedoc_on_3scale"><a class="anchor" href="#_create_mobile_gateway_backend_product_and_activedoc_on_3scale"></a>5.3. Create Mobile Gateway Backend, Product and ActiveDoc on 3scale</h3>
<div class="paragraph">
<p>To integrate and manage the Mobile Gateway API in 3scale, you need to create Products and Backend</p>
</div>
<details>
<summary class="title"><span class="underline"><strong>[Click to know] What are Backend, Product, ActiveDocs and CRDs?</strong></span></summary>
<div class="content">
<div class="ulist">
<ul>
<li>
<p><strong>Backends</strong> are Internal APIs which are then bundled into a 3scale Product.</p>
<div class="ulist">
<ul>
<li>
<p>it contains at least the URL of the API</p>
</li>
<li>
<p>It can optionally be configured with mapping rules, methods and metrics to facilitate reusability.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Products</strong> are the Customer-facing APIs.</p>
<div class="ulist">
<ul>
<li>
<p>It defines the application plans, and configure APIcast</p>
</li>
<li>
<p>You can create API documentation by attaching the Mobile OpenAPI schema as a <strong>3scale ActiveDoc</strong></p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>ActiveDocs</strong> are interactive documentation for your API offered as a framework by 3scale.</p>
<div class="ulist">
<ul>
<li>
<p>With Swagger 2.0 (based on the Swagger Spec) this provides a functional, attractive documentation for the API, which will help developers to explore, to test and integrate with the APIs.</p>
</li>
</ul>
</div>
</li>
<li>
<p>A CRD file allows you to define your own object kinds (Backend, API, ActiveDoc etc) and lets the API Server handle the entire lifecycle of the objects.</p>
</li>
</ul>
</div>
</div>
</details>
<div class="paragraph">
<p>In this workshop you will be using the <strong>3scale Operator</strong> that creates and maintains 3scale on OpenShift with custom resource definitions (CRDs).</p>
</div>
<div class="sect3">
<h4 id="_create_3scale_backend_for_mobile_gateway_service"><a class="anchor" href="#_create_3scale_backend_for_mobile_gateway_service"></a>5.3.1. Create 3scale Backend for Mobile Gateway service</h4>
<div class="paragraph">
<p>To create the Backend for Mobile Gateway, you will need the Service URL of Mobile Gateway deployment running on OpenShift.</p>
</div>
<details>
<summary class="title"><span class="underline"><strong>[Click to know] What is a Service?</strong></span></summary>
<div class="content">
<div class="paragraph">
<p>In OpenShift, a Kubernetes Service serves as an internal load balancer and identifies pods which in turn have the applications. If the application needs to be accessed from outside of OpenShift, you will need OpenShift routes.<br>
In this workshop, since both 3scale and the Mobile Gateway run on OpenShift, 3scale will proxy requests to the backend using Services. This also means the backend cannot be accessed directly from outside OpenShift.</p>
</div>
</div>
</details>
<div class="ulist">
<ul>
<li>
<p>Navigate to the <strong>Dev Spaces browser tab</strong> you have launched at the beginning of this module</p>
<div class="ulist">
<ul>
<li>
<p>If this browser tab is not open, click on %devspaces_dashboard%/dashboard/#/ide/devspaces-%user_name%/cloud-architecture-workshop[Dev Spaces IDE^, window="devspaces"] and login with (%user_name%/%user_password%).</p>
</li>
</ul>
</div>
</li>
<li>
<p>Navigate to the folder <code>workshop &#8594; module-apim &#8594; mobile &#8594; gateway</code> and open the <code>mobile-gateway-backend.yaml</code> file. (Shortcut: <code>Ctrl+P &gt; mobile-gateway-backend.yaml</code>)</p>
</li>
<li>
<p>In the file <code>mobile-gateway-backend.yaml</code>, update the <code>&lt;replace-me&gt;</code> placeholder with the Service endpoint of the Globex Mobile gateway service appended with the port <code>:8080</code>.<br></p>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">http://globex-mobile-gateway.globex-apim-%user_name%.svc.cluster.local:8080</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/mobile-backend-yaml.png" alt="mobile backend yaml">
</div>
<div class="title">Figure 35. Update mobile-gateway-backend.yaml with Service endpoint of Globex Mobile gateway</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The <strong>privateBaseURL</strong> in the <strong>mobile-gateway-backend.yaml</strong> file should read like this:</p>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">privateBaseURL: "http://globex-mobile-gateway.globex-apim-%user_name%.svc.cluster.local:8080"</code></pre>
</div>
</div>
<details>
<summary class="title"><span class="underline"><strong>[Click to know] How to fetch Service URL from OpenShift console?</strong></span></summary>
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Navigate to the <code>globex-apim-%user_name%</code> namespace on the OpenShift console by clicking here %openshift_cluster_console%/topology/ns/globex-apim-%user_name%[APIM module on OpenShift^] and login with (%user_name%/%user_password%).</p>
</li>
<li>
<p>In the <strong>Find by name</strong> filter enter the value <code>mobile-gateway</code>. The <code>globex-mobile-gateway</code> deployment is highlighted. Clicking on this deployment opens the context menu for this deployment</p>
<div class="imageblock">
<div class="content">
<img src="_images/globex-mobile-gateway-deplpyment.png" alt="globex mobile gateway deplpyment">
</div>
<div class="title">Figure 36. Locate globex-mobile-gateway deployment</div>
</div>
</li>
<li>
<p>Under <strong>Services</strong> section you can see the name of the services assocated with this deployment. Click on the <code>globex-mobile-gateway</code> link and you will be taken to the Services page.</p>
</li>
<li>
<p>Under <strong>Service routing &#8594; Hostname</strong>, you can find the service&#8217;s hostname. Make a note of this URL and you will need this to create the Backend on 3scale.</p>
<div class="imageblock">
<div class="content">
<img src="_images/mobile-gateway-services.png" alt="mobile gateway services">
</div>
<div class="title">Figure 37. Mobile Gateway Service in OpenShift</div>
</div>
</li>
</ul>
</div>
</div>
</details>
</li>
<li>
<p>From the Terminal of Dev Space,s that should be open already, run the following command <code>oc whoami</code> to check if you are still logged in as <strong>%user_name%</strong> and <code>oc project</code> to see if you are in the project <code>globex-apim-%user_name%</code></p>
<div class="ulist">
<ul>
<li>
<p>If you are not in <code>globex-apim-%user_name%</code>, run <code>oc project globex-apim-%user_name%</code> to login to the right namespace</p>
<div class="listingblock">
<div class="title">Check logged-in username and project</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc whoami
%user_name%
$ oc project
Using project "globex-apim-%user_name%" on server...</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Run the following command to create a Mobile Gateway Backend in 3scale.</p>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc apply -f /projects/workshop-devspaces/workshop/module-apim/mobile/gateway/mobile-gateway-backend.yaml -n globex-apim-%user_name%</code></pre>
</div>
</div>
</li>
<li>
<p>You should see the output as</p>
<div class="listingblock">
<div class="title">Output of Mobile Gateway Backend creation</div>
<div class="content">
<pre>backend.capabilities.3scale.net/globex-mobile-gateway-backend configured</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_create_3scale_product_for_mobilegateway_api"><a class="anchor" href="#_create_3scale_product_for_mobilegateway_api"></a>5.3.2. Create 3scale Product for MobileGateway API</h4>
<div class="ulist">
<ul>
<li>
<p>In Dev Spaces in the folder <code>workshop &#8594; module-apim &#8594; mobile &#8594; gateway</code>, open the file <code>mobile-gateway-product.yaml</code>. [Shortcut: <code>Ctr+P &gt; mobile-gateway-product.yaml</code>]</p>
<div class="ulist">
<ul>
<li>
<p>This file creates a 3scale Product, and also attaches the Backend we created in the previous step to the Product.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Update the following 2 values as directed below.</p>
<div class="imageblock">
<div class="content">
<img src="_images/mobile-gateway-product.png" alt="mobile gateway product">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>&lt;client-credentials&gt;</strong> : Value of Client Credentials of the <strong>client-manager</strong> client you created in Red Hat SSO in the previous step.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you don&#8217;t have this value, click on Red Hat  %sso_tenant_console%/#/realms/globex-%user_name%/clients[SSO Clients List^, window="sso"]. Login if needed with <strong>(%user_name%/%user_password%)</strong>. Click on the Client ID <strong>client-manager</strong>. You can copy the credentials from the <strong>Credentials tab</strong></p>
</div>
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/client-manager-credentials.png" alt="client manager credentials">
</div>
</div>
</li>
<li>
<p><strong>&lt;issuer-endpoint&gt;</strong> : Value as below</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sso.%openshift_subdomain%/auth/realms/globex-%user_name%</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This URL is from Red Hat SSO&#8217;s <strong>Issuer endpoint</strong> from <a href="https://sso.%openshift_subdomain%/auth/realms/globex-%user_name%/.well-known/openid-configuration" target="_blank" rel="noopener">well-known configurations endpoint</a>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sso-issuer-endpoint.png" alt="sso issuer endpoint">
</div>
<div class="title">Figure 38. Red Hat SSO Issuer URL</div>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>mobile-gateway-product.yaml</code> file should looks like this now<br></p>
<div class="imageblock">
<div class="content">
<img src="_images/mobile-product-gateway-product-issuerendpoint.png" alt="mobile product gateway product issuerendpoint">
</div>
<div class="title">Figure 39. mobile-gateway-product.yaml updated with the correct values</div>
</div>
</li>
<li>
<p>Execute the following command in the Terminal to create this Product for Mobile Gateway</p>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc apply -f /projects/workshop-devspaces/workshop/module-apim/mobile/gateway/mobile-gateway-product.yaml -n globex-apim-%user_name%</code></pre>
</div>
</div>
</li>
<li>
<p>You will the see the following output confirming creation of 3scale Product for Mobile Gateway:</p>
<div class="listingblock">
<div class="title">Output</div>
<div class="content">
<pre>product.capabilities.3scale.net/globex-partner-gateway-product created</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_create_active_doc_for_mobile_gateway"><a class="anchor" href="#_create_active_doc_for_mobile_gateway"></a>5.3.3. Create Active Doc for Mobile Gateway</h4>
<div class="ulist">
<ul>
<li>
<p>In Dev Spaces, navigate to the folder <code>workshop &#8594; module-apim &#8594; mobile &#8594; activedoc</code>, open the file <code>create-mobile-activedoc.yaml</code></p>
<div class="imageblock">
<div class="content">
<img src="_images/mobile-activedoc-yaml.png" alt="mobile activedoc yaml" width="70%">
</div>
</div>
</li>
<li>
<p>Replace the <code>&lt;replace-me&gt;</code> placeholder with the Service Registry OpenAPI endpoint. This is the same OpenAPI spec that you setup on Service Registry.</p>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">%service_registry_url%/apis/registry/v2/groups/globex/artifacts/mobileapi</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/mobile-activedoc-create-file.png" alt="mobile activedoc create file">
</div>
<div class="title">Figure 40. ActiveDoc updated with OpenAPI Service Registry endpoint</div>
</div>
</li>
<li>
<p>Create this Active Doc by running the following command in the Dev Spaces Terminal</p>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc apply -f /projects/workshop-devspaces/workshop/module-apim/mobile/activedoc/create-mobile-activedoc.yaml -n globex-apim-%user_name%</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Output</div>
<div class="content">
<pre>activedoc.capabilities.3scale.net/mobile-gateway-activedoc created</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_setup_mobile_users"><a class="anchor" href="#_setup_mobile_users"></a>5.4. Setup Mobile users</h3>
<div class="paragraph">
<p>The Mobile developers of Globex will need access to the Developer Portal to signup for the APIs exposed to them. Typically they would access the developer portal and signup for an account which may as needed go through an approval process</p>
</div>
<div class="paragraph">
<p>For the purpose of this workshop let us run a few commands to setup these users as defined in the file <code>mobile-dev-setup.yaml</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the <strong>Dev Spaces Terminal</strong> run the following command</p>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc apply -f /projects/workshop-devspaces/workshop/module-apim/mobile/users/mobile-dev-setup.yaml -n globex-apim-%user_name%</code></pre>
</div>
</div>
</li>
<li>
<p>You will see the output as</p>
<div class="listingblock">
<div class="title">Output of user creation</div>
<div class="content">
<pre>secret/mobileuser.secret created
developeraccount.capabilities.3scale.net/mobile-developeraccount created
developeruser.capabilities.3scale.net/admin.mobile created
developeruser.capabilities.3scale.net/dev.mobile created</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_view_the_newly_created_backend_product_activedoc_and_users"><a class="anchor" href="#_view_the_newly_created_backend_product_activedoc_and_users"></a>5.5. View the newly created Backend, Product, ActiveDoc and Users</h3>
<div class="sect3">
<h4 id="_view_on_3scale_admin_console"><a class="anchor" href="#_view_on_3scale_admin_console"></a>5.5.1. View on 3scale admin console</h4>
<div class="ulist">
<ul>
<li>
<p>Navigate to the %3scale_tenant%[3scale admin portal^, window="3scale"] and login using your username and password (%user_name%/%user_password%).</p>
<div class="imageblock">
<div class="content">
<img src="_images/apim-mobile-3scale-login.png" alt="apim mobile 3scale login">
</div>
<div class="title">Figure 41. Launch 3scale</div>
</div>
</li>
<li>
<p>You will notice that the Mobile Product and Backend have been created.</p>
</li>
<li>
<p>Click on <strong>globex-mobile-gateway-product</strong> under <strong>APIs &#8594; Products</strong> section.</p>
</li>
<li>
<p>You are presented with the Product overview page for the Mobile API Product you created. Note the following elements</p>
<div class="ulist">
<ul>
<li>
<p>Published Application Plans</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Application Plans define the different sets of access rights you might want to allow for consumers of your API. These can determine anything from rate limits, which methods or resources are accessible and which features are enabled</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Backend that has been attached to the Mobile Gateway Product</p>
<div class="imageblock">
<div class="content">
<img src="_images/mobile-product-overview.png" alt="mobile product overview">
</div>
<div class="title">Figure 42. Mobile Gateway Product: Overview</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Navigate to <strong>Integration &#8594; Settings</strong> page from the Product overview page. You will notice that the Product has been setup with</p>
<div class="ulist">
<ul>
<li>
<p>OpenID Connect as Authentication mechanism</p>
</li>
<li>
<p><strong>client_manager</strong> client details that you had created in the previous steps.</p>
</li>
<li>
<p>OIDC Authorization Flow includes <strong>Implicit Flow</strong> because we would be authenticating the users SSO as well access to the backend services</p>
<div class="imageblock">
<div class="content">
<img src="_images/mobile-product-openid-settings.png" alt="mobile product openid settings">
</div>
<div class="title">Figure 43. Mobile Gateway Product: Settings</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>The ActiveDoc is visible from the 3scale portal as well under Products. Click on the ActiveDoc to preview the OpenAPI specifications.</p>
<div class="imageblock">
<div class="content">
<img src="_images/apim_3scale_activedoc.png" alt="apim 3scale activedoc">
</div>
<div class="title">Figure 44. Mobile Gateway Product: ActiveDoc</div>
</div>
</li>
<li>
<p>Navigate to <code>Integration &#8594; Configuration</code> and click on the <strong>Promote to v.x Staging APICast</strong> and then <strong>Promote to v.x Production APICast</strong> to promote all the config changes</p>
<div class="ulist">
<ul>
<li>
<p>APIcast is an NGINX based API gateway used to integrate internal and external API services with the 3scale. APIcast can be hosted or self-managed. In this workshop we use the default <code>self-managed</code> option.</p>
<div class="imageblock">
<div class="content">
<img src="_images/mobile-promote-apicast.png" alt="mobile promote apicast">
</div>
<div class="title">Figure 45. Promote Staging and Production APICast</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_viewing_on_openshift_console"><a class="anchor" href="#_viewing_on_openshift_console"></a>5.5.2. Viewing on OpenShift console</h4>
<div class="paragraph">
<p>You can also view these objects on OpenShift console as follows</p>
</div>
<details>
<summary class="title"><span class="underline"><strong>[Click to View] View on 3scale Operator page in OpenShift console</strong></span></summary>
<div class="content">
<div class="ulist">
<ul>
<li>
<p>You can now see that the Backend, Product, ActiveDoc and Users from the 3scale OpenShift operators on %openshift_cluster_console%/k8s/ns/globex-apim-user1/clusterserviceversions[Installed Operators^, window="console"]</p>
<div class="ulist">
<ul>
<li>
<p>Navigate to <code>Red Hat Integration - 3scale &#8594; All Instances</code> and click on <code>Current namespace only</code>. You will see that the Product and Backend have been created.</p>
<div class="imageblock">
<div class="content">
<img src="_images/apim-mobile-back-prod-active-users.png" alt="apim mobile back prod active users">
</div>
<div class="title">Figure 46. View Product, Backend, ActiveDoc and Users</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</details>
</div>
</div>
<div class="sect2">
<h3 id="_setup_globex_dev_portal"><a class="anchor" href="#_setup_globex_dev_portal"></a>5.6. Setup Globex Dev Portal</h3>
<div class="paragraph">
<p>A good developer portal is a must have to assure adoption of your API. In this section we will setup the Dev Portal so that it is ready to be used by Mobile Developers.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Navigate to <code>3scale&#8217;s Audience &#8594;Developer Portal &#8594; Settings</code> by clicking on %3scale_tenant%/site/dns[Settings &#8594; Domains &amp; Access section^, window="3scale"]</p>
</li>
<li>
<p>The <strong>Developer Portal Access Code</strong> hides the site from the world till you are ready.</p>
</li>
<li>
<p>Remove the value in the textfield below the label <strong>Developer Portal Access Code</strong> as shown below. Click on the <strong>Update Account</strong> button. This opens up the Developer Portal to public access without the need for an Access Code.</p>
<div class="imageblock">
<div class="content">
<img src="_images/apim_domain_access.png" alt="apim domain access">
</div>
<div class="title">Figure 47. Remove Developer Portal Access Code</div>
</div>
</li>
<li>
<p>The next step is to allow a Developer to access <strong>Multiple APIs (Services)</strong> and signup for <strong>Multiple Applications</strong></p>
</li>
<li>
<p>Navigate to %3scale_tenant%/p/admin/cms/switches[Developer Portal &#8594; Feature Visibility section, window="3scale"]</p>
</li>
<li>
<p>Click on the <strong>Show</strong> button against the features <strong>Multiple Services</strong> and <strong>Multiple Applications</strong>. The changes are auto-saved.</p>
<div class="imageblock">
<div class="content">
<img src="_images/apim_feature_visbility_init.png" alt="apim feature visbility init">
</div>
<div class="title">Figure 48. Feature Visibility section</div>
</div>
</li>
<li>
<p>After updating the settings, this page should be seen as per the screenshot below.</p>
<div class="imageblock">
<div class="content">
<img src="_images/apim_feature_visibility.png" alt="apim feature visibility">
</div>
<div class="title">Figure 49. Feature Visibility settings altered</div>
</div>
</li>
<li>
<p>The Globex Developer Portal is fully setup now for Mobile developers to signup.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_sign_up_as_a_mobile_developer"><a class="anchor" href="#_sign_up_as_a_mobile_developer"></a>5.7. Sign up as a Mobile Developer</h3>
<div class="paragraph">
<p>In this section you will login as a Mobile Developer (as the user you created in the previous section), and signup for API access</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Launch the Globex Developer Portal by clicking on %globex_developer_portal%[Developer Portal^, window="devportal"]</p>
<div class="imageblock">
<div class="content">
<img src="_images/3scale_dev_portal.png" alt="3scale dev portal">
</div>
<div class="title">Figure 50. Developer Portal</div>
</div>
</li>
<li>
<p>Click on the <strong>SIGN IN</strong> link found on top-right.</p>
</li>
<li>
<p>Sign in as one of the user you created in the previous section with</p>
<div class="ulist">
<ul>
<li>
<p>username: <code>dev.mobile</code></p>
</li>
<li>
<p>password: <code>openshift</code></p>
<div class="imageblock">
<div class="content">
<img src="_images/3scale_dev_portal_signin.png" alt="3scale dev portal signin" width="70%">
</div>
<div class="title">Figure 51. Developer Portal</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Navigate to Applications Listing by choosing the <strong>APPLICATIONS</strong> menu on the top of the page.</p>
<div class="imageblock">
<div class="content">
<img src="_images/3scale_dev_portal_loggedin.png" alt="3scale dev portal loggedin" width="80%">
</div>
<div class="title">Figure 52. Developer Portal Landing Page</div>
</div>
</li>
<li>
<p>In the Applications page you are invited to <strong>Create Application</strong>. Click on the <strong>Create new application</strong> button seen against <code>globex-mobile-gateway-product</code></p>
<div class="imageblock">
<div class="content">
<img src="_images/3scale_dev_portal_applications.png" alt="3scale dev portal applications" width="70%">
</div>
<div class="title">Figure 53. Developer Portal: Create new application</div>
</div>
</li>
<li>
<p>Click on <strong>Subscribe to globex-mobile-gateway-product</strong> link</p>
<div class="imageblock">
<div class="content">
<img src="_images/apim-devportal-mobile-subscribe.png" alt="apim devportal mobile subscribe">
</div>
<div class="title">Figure 54. Subscribe to globex-mobile-gateway-product</div>
</div>
</li>
<li>
<p>You are successfully subscribed to the service</p>
<div class="imageblock">
<div class="content">
<img src="_images/apim-devportal-mobile-subscribe-success.png" alt="apim devportal mobile subscribe success" width="70%">
</div>
<div class="title">Figure 55. Successfully subscribed to the service</div>
</div>
</li>
<li>
<p>Navigate back to the <strong>APPLICATIONS tab</strong> found on the top menu and click <strong>globex-mobile-gateway-product&#8217;s</strong> &gt; <strong>Create new application</strong> link<br></p>
<div class="imageblock">
<div class="content">
<img src="_images/3scale_dev_portal_applications.png" alt="3scale dev portal applications" width="70%">
</div>
<div class="title">Figure 56. Developer Portal: Create new application (again)</div>
</div>
</li>
<li>
<p>Give the plan a <strong>Name</strong> and a <strong>Description</strong> and click on <strong>Create Application</strong></p>
<div class="imageblock">
<div class="content">
<img src="_images/apim-devportal-mobile-create-new-app-2.png" alt="apim devportal mobile create new app 2" width="70%">
</div>
<div class="title">Figure 57. Developer Portal: New application</div>
</div>
</li>
<li>
<p>An application is created successfully. Make a note of the <strong>Client ID</strong> and <strong>Client Secret</strong>. You will be using this in the Mobile App setup. Scratchpad can be used for this as well.</p>
</li>
<li>
<p>Enter the value asterisk (*) in the <strong>REDIRECT URL</strong> field and click on the <strong>Submit</strong> button. This is to setup the right Redirect URL for OAuth using Red Hat SSO.</p>
<div class="ulist">
<ul>
<li>
<p>In real-life you would never mark this as (*), but provide the correct URL based on your application.</p>
<div class="imageblock">
<div class="content">
<img src="_images/apim-devportal-mobile-app-success.png" alt="apim devportal mobile app success" width="90%">
</div>
<div class="title">Figure 58. Update REDIRECT URL in the Application creates successfully for Mobile User</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Copy the <strong>Client ID</strong> from this page which will be used to setup Mobile App</p>
</li>
<li>
<p>In Dev Spaces open the file: <strong>Dev Spaces &#8594; workshop &#8594; module-apim &#8594; mobile &#8594; mobile-env-patch.sh</strong></p>
<div class="ulist">
<ul>
<li>
<p>Substitute <code>&lt;replace-me&gt;</code> found against the <code>API_CLIENT_ID</code> variable with the <strong>Client ID</strong> in the previous step</p>
<div class="imageblock">
<div class="content">
<img src="_images/mobile-clientid-env-patch.png" alt="mobile clientid env patch" width="70%">
</div>
<div class="title">Figure 59. Update client_id into mobile-env-patch file</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Back in the Developer Portal Click on <strong>DOCUMENTATION</strong> navigation on the top of the page.</p>
</li>
<li>
<p>The <strong>Documentation</strong> page displays all the available APIs including the default API as well as <strong>globex-mobile-gateway-product</strong></p>
<div class="imageblock">
<div class="content">
<img src="_images/dev_portal_mobile_doc.png" alt="dev portal mobile doc" width="80%">
</div>
<div class="title">Figure 60. Dev Portal: Documentation Page</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Copy the URL displayed under "Service Endpoint" in <strong>globex-mobile-gateway-product</strong> box</p>
</li>
<li>
<p>In Dev Spaces navigate back to the open file: <strong>Dev Spaces &#8594; workshop &#8594; module-apim &#8594; module &#8594; mobile-env-patch.sh</strong></p>
</li>
<li>
<p>Substitute <code>&lt;replace-me&gt;</code> found against the <code>GLOBEX_MOBILE_GATEWAY</code> variable with the <strong>Service Endpoint</strong> in the previous step</p>
<div class="imageblock">
<div class="content">
<img src="_images/mobile-mobgateway-env-patch.png" alt="mobile mobgateway env patch" width="60%">
</div>
<div class="title">Figure 61. Update GLOBEX_MOBILE_GATEWAY into mobile-env-patch file</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>In the same file update the <strong>&lt;replace-me&gt;</strong> tags for the <strong>SSO_AUTHORITY</strong> and <strong>SSO_REDIRECT_LOGOUT_URI</strong> fields with the following variables</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSO_AUTHORITY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">https://sso.%openshift_subdomain%/auth/realms/globex-%user_name%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSO_REDIRECT_LOGOUT_URI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">https://globex-mobile-globex-apim-%user_name%.%openshift_subdomain%/home</p></td>
</tr>
</tbody>
</table>
<div class="imageblock">
<div class="content">
<img src="_images/mobile-sso-env-patch.png" alt="mobile sso env patch">
</div>
<div class="title">Figure 62. Update SSO details into mobile-env-patch file</div>
</div>
</li>
<li>
<p>Finally the <code>mobile-env-patch.sh file should look like this. Save the file by `Ctrl+S</code></p>
<div class="imageblock">
<div class="content">
<img src="_images/mobile-full-env-patch.png" alt="mobile full env patch">
</div>
<div class="title">Figure 63. Fully updated mobile-env-patch file</div>
</div>
</li>
<li>
<p>Execute this script in the Terminal by running the following command in Dev spaces' Terminal</p>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc project globex-apim-%user_name%
sh /projects/workshop-devspaces/workshop/module-apim/mobile/mobile-env-patch.sh</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Output of running mobile-env-patch.sh script</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">deployment.apps/globex-mobile updated</code></pre>
</div>
</div>
</li>
<li>
<p>The Mobile App Deployment is patched with the necessary variables. You can view this navigating to %openshift_cluster_console%/k8s/ns/globex-apim-%user_name%/deployments/globex-mobile/environment[globex-mobile deployment, window="console"]</p>
<div class="imageblock">
<div class="content">
<img src="_images/apim_globex_mobile_deployment.png" alt="apim globex mobile deployment">
</div>
<div class="title">Figure 64. globex-mobile deployment on OpenShift</div>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_update_red_hat_ssos_web_origin_to_match_mobile_app"><a class="anchor" href="#_update_red_hat_ssos_web_origin_to_match_mobile_app"></a>5.7.1. Update Red Hat SSO&#8217;s Web Origin to match Mobile App</h4>
<div class="paragraph">
<p>There is one last step that you need to do before trying out the Mobile App. You need to update the <strong>Web Origin</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Navigate to click on %sso_tenant_console%/#/realms/globex-%user_name%/clients[Red Hat SSO Clients List^,window="sso"]. Login if needed with <strong>(%user_name%/%user_password%)</strong>.</p>
<div class="imageblock">
<div class="content">
<img src="_images/rh-sso-mobile-client.png" alt="rh sso mobile client">
</div>
<div class="title">Figure 65. Red Hat SSO Clients List for Mobile client</div>
</div>
</li>
<li>
<p>Click on the new Client ID that was created when you signed up for Mobile Gateway Application</p>
<details>
<summary class="title"><span class="underline"><strong>Where do I find this Client ID?</strong></span></summary>
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Navigate to the %globex_developer_portal%/admin/applications[Globex Developer Portal Applications^, window="devportal"]</p>
</li>
<li>
<p>The client ID is displayed against the <code>globex-mobile-gateway-product</code> product.</p>
<div class="imageblock">
<div class="content">
<img src="_images/mobile-dev-portal-clientid.png" alt="mobile dev portal clientid">
</div>
<div class="title">Figure 66. globex-mobile deployment on OpenShift</div>
</div>
</li>
</ul>
</div>
</div>
</details>
</li>
<li>
<p>Close to the bottom of this page, you would see the <strong>Web Origins</strong> field.</p>
</li>
<li>
<p>Update this field with the following value and click on <strong>Save</strong></p>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">https://globex-mobile-globex-apim-%user_name%.%openshift_subdomain%</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/apim_mobile_sso_weborigin.png" alt="apim mobile sso weborigin">
</div>
<div class="title">Figure 67. Update Web Origin in Red Hat SSO&#8217;s new Client ID, and click on Save.</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_section_outcome_2"><a class="anchor" href="#_section_outcome_2"></a>5.8. Section Outcome</h3>
<div class="ulist">
<ul>
<li>
<p>3scale Backend, Product, ActiveDocs and Users were created</p>
</li>
<li>
<p>Developer Portal was setup for public access without Access Code</p>
</li>
<li>
<p>Signed for an Application as a Mobile Developer</p>
</li>
<li>
<p>Patched Red Hat SSO Web Origin so that the calls from Globex Mobile App will not cause errors</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_test_mobile_application"><a class="anchor" href="#_test_mobile_application"></a>6. Test Mobile Application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the previous section, you signed up for access as a Mobile Developer and gained credentials to access the Globex Mobile Gateway API. In this section you will complete Mobile App configuration and test this out</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As part of this workshop, you will use a mobile-friendly Angular App and not a mobile-native app. So no mobile app installation is necessary. This Mobile App is work in progress and at present shows only categories and products within each category.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Mobile Application can be access via this QR Code as well as via browser</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Scan the following QR Code with your mobile phone</p>
<div class="imageblock">
<div class="content">
<img src="https://chart.googleapis.com/chart?chs=300x300&amp;cht=qr&amp;chl=https://globex-mobile-globex-apim-%user_name%.%openshift_subdomain%" alt="Globex Mobile" width="200" height="300">
</div>
<div class="title">Figure 68. Scan to view Mobile App</div>
</div>
</li>
<li>
<p>Alternatively, launch <a href="https://globex-mobile-globex-apim-%user_name%.%openshift_subdomain%" target="_blank" rel="noopener">Globex Mobile</a> and login using (asilva/openshift)</p>
</li>
<li>
<p>The login process may take a few seconds. Please wait for bit :)</p>
<div class="imageblock">
<div class="content">
<img src="_images/apim-mobile-loggedin.png" alt="apim mobile loggedin" width="40%">
</div>
<div class="title">Figure 69. User is logged in</div>
</div>
</li>
<li>
<p>After logging in, click on the <strong>View the categories</strong> button. You will view on a list of Categories available</p>
<div class="imageblock">
<div class="content">
<img src="_images/mobile-categories.png" alt="mobile categories" width="40%">
</div>
<div class="title">Figure 70. Categories view</div>
</div>
</li>
<li>
<p>Click on the 'Clothing' category to view the Product Listing.</p>
</li>
<li>
<p>Try out a few more categories too which will help us to generate some traffic to view in the Analytics section.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_analytics"><a class="anchor" href="#_analytics"></a>6.1. Analytics</h3>
<div class="ulist">
<ul>
<li>
<p>Navigate to the %globex_developer_portal%/buyer/stats[Globex Developer Portal Statistics^, window="devportal"]</p>
</li>
<li>
<p>From the dropdown indicated in this screenshot, choose the Mobile Gateway API&#8217;s application plan (which is  <code>basic-plan</code> in this case).</p>
</li>
<li>
<p>You will be presented with the statistics graph of the calls made to this gateway by the Partner Developer&#8217;s access.</p>
<div class="imageblock">
<div class="content">
<img src="_images/apim-mobile-analytics.png" alt="apim mobile analytics">
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_under_the_hood"><a class="anchor" href="#_under_the_hood"></a>6.2. Under the hood</h3>
<div class="paragraph">
<p>As part of this Section you tried out the Mobile App.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The user <strong>asilva</strong> you logged into the Mobile App as, is authenticated using Red Hat SSO.</p>
</li>
<li>
<p>Once the user logs in, a token is generated by Red Hat SSO using the Client ID, SSO Authority details that you passed to the Mobile App to setup the configuration</p>
</li>
<li>
<p>This token is authenticated by 3scale to ensure the Client ID indeed has access to that particular API</p>
</li>
<li>
<p>The token is also passed onto the backend service running on OpenShift, which checks for validity of the token.</p>
</li>
<li>
<p>The <a href="https://github.com/rh-cloud-architecture-workshop/globex-mobile-gateway/blob/main/src/main/java/org/globex/gateway/mobile/rest/MobileCatalogResource.java" target="code-samples">REST endpoints</a> is supplied with the SSO URL information as part of the <a href="https://github.com/rh-cloud-architecture-workshop/globex-mobile-gateway/blob/main/src/main/resources/application.properties" target="code-samples">application.properties</a></p>
</li>
<li>
<p>The endpoints are protected with @Authenticated which in this case looks for a valid token being present.</p>
<div class="imageblock">
<div class="content">
<img src="_images/mobile_rest_java.png" alt="mobile rest java" width="80%">
</div>
<div class="title">Figure 71. REST endpoint is annotated with @Authenticated</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>With that we wrap up the activities <strong>Design, Govern, Manage, Secure</strong> Globex Mobile Gateway APIs for access from the Mobile Application securely.</p>
</div>
<div class="paragraph">
<p>Coming up next: We will setup the Globex Partner APIs for access by external Partner portals.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you are running out time, now is a good time to switch to a different module.</p>
</div>
<div class="paragraph">
<p>The Partner Portal section is quite similar to the Mobile App but for the fact that the Partner Users are not managed by Red Hat SSO. Therefore Partner Portal authenticates itself using the <strong>Client Credentials</strong> method using a client ID and secret. The authentication is only through the backend services of the Partner Portal without users getting into the picture.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><br></p>
</div>
</div>
<div class="sect2">
<h3 id="_cleanup_2"><a class="anchor" href="#_cleanup_2"></a>6.3. Cleanup</h3>
<div class="paragraph">
<p>You can now close all the tabs except for this Instructions and Dev Spaces browser tabs. Close all files open within Dev Spaces as well.</p>
</div>
<div class="paragraph">
<p>If you choose to proceed to another module, close all but this <strong>Instructions</strong> browser before starting the next module. Go back to the <a href="workshop-goals"><strong>Overview Page</strong></a> to choose your next module.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_setup_partner_gateway_and_partner_web_app_optional"><a class="anchor" href="#_setup_partner_gateway_and_partner_web_app_optional"></a>7. Setup Partner Gateway and Partner Web App (Optional)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before we start this section, close all the browser tabs except for this <strong>Instructions tab</strong> and <strong>Dev Spaces</strong> tab. This will help you navigate this section more easily.</p>
</div>
<div class="paragraph">
<p>Since we&#8217;ve gone through the Design and Governance sections of the Mobile API, in this section we will skip the design section. We&#8217;ll also keep discussions to only essentials :)</p>
</div>
<div class="sect2">
<h3 id="_publish_partner_api_to_service_registry"><a class="anchor" href="#_publish_partner_api_to_service_registry"></a>7.1. Publish Partner API to Service Registry</h3>
<div class="ulist">
<ul>
<li>
<p>If you don&#8217;t have a browser tab open with OpenShift Dev Spaces, click on %devspaces_dashboard%/dashboard/#/ide/devspaces-%user_name%/cloud-architecture-workshop[Dev Spaces IDE^, window="devspaces"]. If needed login with your username and password (%user_name%/%user_password%).</p>
</li>
<li>
<p>In Dev Spaces, navigate to the folder <code>workshop &#8594; module-apim &#8594; partner &#8594; activedoc</code>, and open the file <code>partner-activedoc-draft.json</code>.</p>
<div class="ulist">
<ul>
<li>
<p>Or type [Ctrl+P] and type the file name as <code>partner-activedoc-draft.json</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Scroll to the bottom of the page where you can see the <strong>securitySchemes</strong> section</p>
<div class="imageblock">
<div class="content">
<img src="_images/partner-api-securty-scheme.png" alt="partner api securty scheme">
</div>
<div class="title">Figure 72. Partner OpenAPI Security Schemes section</div>
</div>
</li>
<li>
<p>Substitute <strong>&lt;replace-me&gt;</strong> with the Red Hat SSO&#8217;s OpenID Provider Configuration shown below</p>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">https://sso.%openshift_subdomain%/auth/realms/globex-%user_name%/.well-known/openid-configuration</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/partner-sec-scheme-updated.png" alt="partner sec scheme updated">
</div>
<div class="title">Figure 73. Updated Security Scheme</div>
</div>
</li>
<li>
<p>Execute the following command from the Dev Spaces' Terminal.</p>
<div class="ulist">
<ul>
<li>
<p>This command makes a POST to the Service Registry API to create an OpenAPI schema for Partner Gateway API.</p>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -X POST -H "Content-type: application/json; artifactType=OPENAPI" -H "X-Registry-ArtifactId: partnerapi" -d @/projects/workshop-devspaces/workshop/module-apim/partners/activedoc/partner-activedoc-draft.json %service_registry_url%/apis/registry/v2/groups/globex/artifacts</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>The following JSON is returned back by Service Registry confirming creation</p>
<div class="listingblock">
<div class="title">Output response from Service Registry</div>
<div class="content">
<pre>{"name":"Globex Partners API Gateway","description":"Globex APIs made accessible to global partners to view Globex's catalog and products","createdBy":"","createdOn":"2023-05-05T22:51:01+0000","modifiedBy":"","modifiedOn":"2023-05-05T22:51:01+0000","id":"partnerapi","version":"1","type":"OPENAPI","globalId":2,"state":"ENABLED","groupId":"globex","contentId":2,"references":[]}workshop-devspaces (main)</pre>
</div>
</div>
</li>
<li>
<p>You can view the newly created OpenAPI specification %service_registry_url%/ui/artifacts/globex/partnerapi/versions/latest[here^, window="serviceregistry"]</p>
<div class="ulist">
<ul>
<li>
<p>You can close the Service Registry browser tab.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_create_backend_products_activedoc_and_users_for_partner_gateway"><a class="anchor" href="#_create_backend_products_activedoc_and_users_for_partner_gateway"></a>7.2. Create Backend, Products, ActiveDoc and Users for Partner Gateway</h3>
<div class="sect3">
<h4 id="_create_backend"><a class="anchor" href="#_create_backend"></a>7.2.1. Create Backend</h4>
<div class="ulist">
<ul>
<li>
<p>In Dev Spaces , under the folder <code>workshop &#8594; module-apim &#8594; partners &#8594; gateway</code>, open the file <code>partner-gateway-backend.yaml</code></p>
</li>
<li>
<p>Substitute <strong>"&lt;replace-me&gt;"</strong> with the Service endpoint of the Globex Partner gateway service appended with the port as <code>:8080</code>. This URL is given below</p>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">http://globex-partner-gateway.globex-apim-%user_name%.svc.cluster.local:8080</code></pre>
</div>
</div>
</li>
<li>
<p>After substitution the <strong>partner-gateway-backend.yaml</strong> file should looks like</p>
<div class="imageblock">
<div class="content">
<img src="_images/partner-gateway-backend.png" alt="partner gateway backend" width="80%">
</div>
<div class="title">Figure 74. partner-gateway-backend file</div>
</div>
</li>
<li>
<p>Run the following command which will create a Partner Gateway Backend in 3scale.</p>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc apply -f /projects/workshop-devspaces/workshop/module-apim/partners/gateway/partner-gateway-backend.yaml -n globex-apim-%user_name%</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>backend.capabilities.3scale.net/globex-partner-gateway-backend created</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_create_products"><a class="anchor" href="#_create_products"></a>7.2.2. Create Products</h4>
<div class="ulist">
<ul>
<li>
<p>In Dev Spaces , under the folder <code>workshop &#8594; module-apim &#8594; partners &#8594; gateway</code>, open the file <code>partner-gateway-product.yaml</code></p>
<div class="imageblock">
<div class="content">
<img src="_images/partner-gateway-product.png" alt="partner gateway product" width="80%">
</div>
<div class="title">Figure 75. partner-gateway-product.yaml file</div>
</div>
</li>
<li>
<p>Get the value for <strong>&lt;client-credentials&gt;</strong> placeholder as described below. Or if you have copied this into Scratchpad you can use that instead.</p>
<div class="ulist">
<ul>
<li>
<p>Open the %sso_tenant_console%/#/realms/globex-%user_name%/clients[SSO Clients List^, window="sso"] from Red Hat SSO.</p>
</li>
<li>
<p>Login if needed with <strong>(%user_name%/%user_password%)</strong>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In case you see an error stating <strong>You don&#8217;t have access to the requested resource</strong>, you may notice that you are logged in as a user other than <strong>%user_name%</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Click on <strong>Sign Out</strong> and close the browser</p>
</li>
<li>
<p>Reopen the %sso_tenant_console%/#/realms/globex-%user_name%/clients[Red Hat SSO Clients List^, window="sso"].</p>
</li>
<li>
<p>Login as <strong>(%user_name%/%user_password%)</strong>.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/sso-login-error.png" alt="sso login error">
</div>
<div class="title">Figure 76. Red Hat SSO Login error</div>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Click on the Client ID <strong>client-manager</strong>. You can copy the credentials from the <strong>Credentials tab</strong></p>
<div class="imageblock">
<div class="content">
<img src="_images/client-manager-credentials.png" alt="client manager credentials">
</div>
<div class="title">Figure 77. client_manager credentials</div>
</div>
</li>
<li>
<p>In the <strong>partner-gateway-product.yaml</strong> file, in Dev Spaces, substitute the following values</p>
<div class="ulist">
<ul>
<li>
<p>Substitute <strong>&lt;client-credentials&gt;</strong>  with the Secret from the Client ID <strong>client-manager</strong> from the previous step</p>
</li>
<li>
<p>Substitute <strong>&lt;issuerEndpoint&gt;</strong> with the following value</p>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sso.%openshift_subdomain%/auth/realms/globex-%user_name%</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>The file <code>partner-gateway-product.yaml</code> looks like this now.</p>
<div class="imageblock">
<div class="content">
<img src="_images/product-gateway-product-issuerendpoint.png" alt="product gateway product issuerendpoint">
</div>
</div>
</li>
<li>
<p>Run the following command in the Dev Spaces Terminal to create the product</p>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc apply -f /projects/workshop-devspaces/workshop/module-apim/partners/gateway/partner-gateway-product.yaml -n globex-apim-%user_name%</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Output</div>
<div class="content">
<pre>product.capabilities.3scale.net/globex-partner-gateway-product created</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_create_active_doc_for_partner_gateway"><a class="anchor" href="#_create_active_doc_for_partner_gateway"></a>7.3. Create Active Doc for Partner Gateway</h3>
<div class="ulist">
<ul>
<li>
<p>In Dev Spaces, navigate to the folder <code>workshop &#8594; module-apim &#8594; partners &#8594; activedoc</code>, open the file <code>create-partner-activedoc.yaml</code></p>
<div class="imageblock">
<div class="content">
<img src="_images/mobile-activedoc-yaml.png" alt="mobile activedoc yaml" width="70%">
</div>
</div>
</li>
<li>
<p>Replace the <code>&lt;replace-me&gt;</code> placeholder with the Service Registry OpenAPI endpoint for Partner API show below</p>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">%service_registry_url%/apis/registry/v2/groups/globex/artifacts/partnerapi</code></pre>
</div>
</div>
</li>
<li>
<p>Create this Active Doc by running the following command in the Dev Spaces Terminal</p>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc apply -f /projects/workshop-devspaces/workshop/module-apim/partners/activedoc/create-partner-activedoc.yaml -n globex-apim-%user_name%</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Output</div>
<div class="content">
<pre>activedoc.capabilities.3scale.net/partner-gateway-activedoc created</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_setup_partner_users"><a class="anchor" href="#_setup_partner_users"></a>7.4. Setup Partner users</h3>
<div class="ulist">
<ul>
<li>
<p>Create this Active Doc by running the following command in the Dev Spaces Terminal</p>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc apply -f /projects/workshop-devspaces/workshop/module-apim/partners/users/partner-dev-setup.yaml -n globex-apim-%user_name%</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Output</div>
<div class="content">
<pre>secret/partner.secret created
developeraccount.capabilities.3scale.net/partner-developeraccount created
developeruser.capabilities.3scale.net/admin.partner created
developeruser.capabilities.3scale.net/user.partner created</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_configurations_on_3scale_admin_console"><a class="anchor" href="#_configurations_on_3scale_admin_console"></a>7.5. Configurations on 3scale admin console</h3>
<div class="ulist">
<ul>
<li>
<p>Navigate to the %3scale_tenant%[3scale admin portal^, window="3scale"] and login using your username and password (%user_name%/%user_password%).</p>
<div class="imageblock">
<div class="content">
<img src="_images/apim-partner-3scale-login.png" alt="apim partner 3scale login">
</div>
<div class="title">Figure 78. Launch 3scale</div>
</div>
</li>
<li>
<p>You will notice that the Partner Product and Backend have been created.</p>
</li>
<li>
<p>Click on <strong>globex-partner-gateway-product</strong> under <strong>APIs &#8594; Products</strong> section.</p>
</li>
<li>
<p>You are presented with the Product overview page for the Partner API Product you created.</p>
</li>
<li>
<p>Navigate to <code>Integration &#8594; Configuration</code> and click on the <strong>Promote to v.x Staging APICast</strong> and then <strong>Promote to v.x Production APICast</strong> to promote all the config changes</p>
<div class="imageblock">
<div class="content">
<img src="_images/partner-promote-apicast.png" alt="partner promote apicast">
</div>
<div class="title">Figure 79. Promote Staging and Production APICast</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_signup_for_an_application_as_a_partner"><a class="anchor" href="#_signup_for_an_application_as_a_partner"></a>7.6. Signup for an application as a Partner</h3>
<div class="ulist">
<ul>
<li>
<p>Navigate to the Developer Portal %globex_developer_portal%[Globex Developer Portal^, window="devportal"]</p>
</li>
<li>
<p>If you are already signed in, clicking on the Exit option on top-right of the page.</p>
<div class="imageblock">
<div class="content">
<img src="_images/logout.png" alt="logout" width="80%">
</div>
<div class="title">Figure 80. Logout if already signed in</div>
</div>
</li>
<li>
<p>Click on <strong>SIGN IN</strong> on top right of the page and login using username and password as <strong>(user.partner/openshift)</strong></p>
</li>
<li>
<p>Navigate to Applications Listing by choosing the <strong>APPLICATIONS</strong> menu on the top of the page.</p>
<div class="imageblock">
<div class="content">
<img src="_images/3scale_dev_portal_loggedin.png" alt="3scale dev portal loggedin" width="80%">
</div>
<div class="title">Figure 81. Developer Portal Landing Page</div>
</div>
</li>
<li>
<p>In the Applications page you are invited to <strong>Create Application</strong>. Click on the <strong>Create new application</strong> button seen against <code>globex-partner-gateway-product</code></p>
<div class="imageblock">
<div class="content">
<img src="_images/partner_3scale_dev_portal_applications.png" alt="partner 3scale dev portal applications" width="70%">
</div>
<div class="title">Figure 82. Developer Portal: Create new application</div>
</div>
</li>
<li>
<p>Click on <strong>Subscribe to globex-partner-gateway-product</strong> link</p>
<div class="imageblock">
<div class="content">
<img src="_images/apim-devportal-partner-subscribe.png" alt="apim devportal partner subscribe">
</div>
<div class="title">Figure 83. Subscribe to globex-mobile-gateway-product</div>
</div>
</li>
<li>
<p>You are successfully subscribed to the service</p>
<div class="imageblock">
<div class="content">
<img src="_images/apim-devportal-partner-subscribe-success.png" alt="apim devportal partner subscribe success" width="70%">
</div>
<div class="title">Figure 84. Successfully subscribed to the service</div>
</div>
</li>
<li>
<p>Navigate back to the <strong>APPLICATIONS tab</strong> via the top menu.</p>
</li>
<li>
<p>Under <strong>globex-partner-gateway-product&#8217;s</strong>, click on the <strong>Create new application</strong> button<br></p>
<div class="imageblock">
<div class="content">
<img src="_images/3scale_dev_portal_applications_partner.png" alt="3scale dev portal applications partner" width="70%">
</div>
<div class="title">Figure 85. Developer Portal: Create new application (again)</div>
</div>
</li>
<li>
<p>In the NEW APPLICATION page, give the plan a <strong>Name</strong> and a <strong>Description</strong> and click on <strong>Create Application</strong>.</p>
<div class="imageblock">
<div class="content">
<img src="_images/apim-devportal-partner-create-new-app-2.png" alt="apim devportal partner create new app 2" width="70%">
</div>
<div class="title">Figure 86. Developer Portal: New application</div>
</div>
</li>
<li>
<p>An application is created successfully. Make a note of the <strong>Client ID</strong> and <strong>Client Secret</strong>. You will be using this in the Partner Web Portal setup.</p>
</li>
<li>
<p>Enter the value asterisk (*) in the <strong>REDIRECT URL</strong> field and click on the <strong>Submit</strong> button. This is to setup the right Redirect URL for OAuth using Red Hat SSO</p>
<div class="imageblock">
<div class="content">
<img src="_images/apim-devportal-partner-app-success.png" alt="apim devportal partner app success" width="70%">
</div>
<div class="title">Figure 87. Update REDIRECT URL in the Application creates successfully for Partner User</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_setup_partner_web_portal"><a class="anchor" href="#_setup_partner_web_portal"></a>7.7. Setup Partner Web Portal</h3>
<div class="ulist">
<ul>
<li>
<p>In the previous section, you signed up for access as a Partner Developer and gained credentials to access the APIs Globex exposes.</p>
</li>
<li>
<p>To update the Partner Web application you need these values</p>
<div class="ulist">
<ul>
<li>
<p><strong>Client ID &amp; Client Secret</strong> - Needs to be fetched from Red Hat SSO</p>
</li>
<li>
<p><strong>Token URL</strong> - From Red Hat SSO - But available here in the instructions</p>
</li>
<li>
<p><strong>Globex API Endpoint</strong> - From Red Hat 3scale - But available here in the instructions</p>
</li>
</ul>
</div>
</li>
<li>
<p>These values are part of %openshift_cluster_console%/k8s/ns/globex-apim-%user_name%/deployments/globex-partner-web/environment[globex-partner-web deployment, window="console"] and are highlighted in the screenshot below</p>
<div class="imageblock">
<div class="content">
<img src="_images/partner-web-deployment-env.png" alt="partner web deployment env">
</div>
<div class="title">Figure 88. globex-partner-web Deployment</div>
</div>
</li>
<li>
<p>The <strong>Client ID</strong> and <strong>Client Secret</strong> with values as placeholders are predeployed as a Kubernetes Secret called <strong>secret.yaml</strong>.</p>
<div class="ulist">
<ul>
<li>
<p>In the Dev workspace, under the folder <code>/projects/workshop-devspaces/workshop/module-apim/partners/partner-web</code>  open the file <strong>secret.yaml</strong></p>
<div class="imageblock">
<div class="content">
<img src="_images/partner_secret_yaml.png" alt="partner secret yaml" width="60%">
</div>
<div class="title">Figure 89. secret.yaml</div>
</div>
</li>
<li>
<p>Update the <strong>Client ID</strong> and <strong>Client Secret</strong> from the previous step on 3scale Developer Portal</p>
<div class="imageblock">
<div class="content">
<img src="_images/apim-devportal-partner-clientid.png" alt="apim devportal partner clientid" width="70%">
</div>
<div class="title">Figure 90. Client ID and Client Secret from 3scale Developer Portal</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Update <strong>Token URL</strong> with the following value</p>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">https://sso.%openshift_subdomain%/auth/realms/globex-%user_name%/protocol/openid-connect/token</code></pre>
</div>
</div>
</li>
<li>
<p>In the <strong>Dev Spaces Terminal</strong> apply changes made to the <strong>secret.yaml</strong> by running the following command</p>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc apply -f /projects/workshop-devspaces/workshop/module-apim/partners/partner-web/secret.yaml -n globex-apim-%user_name%</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Output</div>
<div class="content">
<pre>secret/globex-partner-web configured</pre>
</div>
</div>
</li>
<li>
<p>The final step is to patch the Partner Web portal with the <strong>Partner Gateway API&#8217;s endpoint</strong>.</p>
<div class="ulist">
<ul>
<li>
<p>You would ideally get this from 3scale. But since you have learnt how to do this with Mobile API, we will skip navigating to 3scale to save some time.</p>
</li>
<li>
<p>Execute this script in the Dev Spaces Terminal</p>
<div class="listingblock copy">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc set env deployments/globex-partner-web --overwrite GLOBEX_PARTNER_GATEWAY=https://globex-partner-gateway-product-3scale-%user_name%-apicast-production.%openshift_subdomain%</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Output</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">deployment.apps/globex-partner-web updated</code></pre>
</div>
</div>
<details>
<summary class="title"><span class="underline"><strong>[Click to know] How do I verify what I just did?</strong></span></summary>
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Ensure the %openshift_cluster_console%/k8s/ns/globex-apim-%user_name%/deployments/globex-partner-web/environment[globex-partner-web deployment, window="console"] looks like this now</p>
<div class="imageblock">
<div class="content">
<img src="_images/globex-partner-web-filled.png" alt="globex partner web filled">
</div>
<div class="title">Figure 91. Partner Web Portal Deployment Values</div>
</div>
</li>
<li>
<p>To check the Secret that you updated, you can navigate to %openshift_cluster_console%/k8s/ns/globex-apim-%user_name%/secrets/globex-partner-web[globex-partner-web secret^, window="console"]. Scroll down to the <strong>Data</strong> section, and click on <strong>Reveal values</strong></p>
<div class="imageblock">
<div class="content">
<img src="_images/partner-web-secret.png" alt="partner web secret">
</div>
<div class="title">Figure 92. Partner Web Portal Secret with SSO details</div>
</div>
</li>
</ul>
</div>
</div>
</details>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_test_partner_web_application"><a class="anchor" href="#_test_partner_web_application"></a>8. Test Partner Web Application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the previous section, you signed up for access as a Partner Developer and gained credentials to access the Globex PArtner Gateway API. You also setup the necessary configurations for the Partner Web Application.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Launch the <a href="https://globex-partner-web-globex-apim-%user_name%.%openshift_subdomain%" target="_blank" rel="noopener">Globex Partner Web</a></p>
<div class="imageblock">
<div class="content">
<img src="_images/partner_web_portal.png" alt="partner web portal">
</div>
<div class="title">Figure 93. Partner Web Portal</div>
</div>
</li>
<li>
<p>Login using username/password as <strong>(partner/openshift)</strong>.</p>
<div class="ulist">
<ul>
<li>
<p>It is notable that the partner users are not managed using Red Hat SSO.</p>
</li>
</ul>
</div>
</li>
<li>
<p>After logging in, the entire product list is shown in a paginated format.</p>
<div class="ulist">
<ul>
<li>
<p>Allow a few seconds for the catalogue to load</p>
</li>
</ul>
</div>
</li>
<li>
<p>Reload this page by hitting the Browser Refresh a few times which will help us to generate some analytics.</p>
<div class="imageblock">
<div class="content">
<img src="_images/apim-partner-loggedin.png" alt="apim partner loggedin" width="80%">
</div>
<div class="title">Figure 94. User logged in and can view paginated products</div>
</div>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_analytics_2"><a class="anchor" href="#_analytics_2"></a>8.1. Analytics</h3>
<div class="ulist">
<ul>
<li>
<p>Navigate to the %globex_developer_portal%/buyer/stats[Globex Developer Portal Statistics^, window="devportal"]</p>
</li>
<li>
<p>From the dropdown indicated in this screenshot, choose the Partner Gateway API&#8217;s application plan (which is  <code>partner-basic</code> in this case).</p>
</li>
<li>
<p>You will be presented with the statistics graph of the calls made to this gateway by the Partner Developer&#8217;s access.</p>
<div class="imageblock">
<div class="content">
<img src="_images/apim-partner-analytics.png" alt="apim partner analytics">
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_under_the_hood_2"><a class="anchor" href="#_under_the_hood_2"></a>8.2. Under the hood</h3>
<div class="paragraph">
<p>As part of this Section you setup and tested the Partner Web App.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The user <strong>partner</strong> that you logged into the Partner App as, is not authenticated using Red Hat SSO. In fact it is not authenticated at all.</p>
<div class="ulist">
<ul>
<li>
<p>This is because the way partners handle user authentication is not something that Globex is concerned about at all.</p>
</li>
</ul>
</div>
</li>
<li>
<p>In this scenario we use Client Credentials authentication, because the backend NodeJS server authenticates itself with Client ID and Credentials obtained by the Partner Developer while signing up for an Application via 3scale Developer Portal</p>
</li>
<li>
<p>The token generated by NodeJS is then exchanged with 3scale to ensure the Client ID indeed has access to that particular API</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_congratulations"><a class="anchor" href="#_congratulations"></a>9. Congratulations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>With this you have completed the <strong>Contract First API</strong> module!</p>
</div>
<div class="paragraph">
<p>Please close all but this <strong>Instructions browser tab</strong> to avoid proliferation of tabs which can make working on other modules difficult.</p>
</div>
<div class="paragraph">
<p>Proceed to the <a href="workshop-goals"><strong>Overview Page</strong></a> to choose your next module.</p>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <img
          src="../_/img/app-services-logo.png" height="40px" alt="Cloud Native Architecture Solution Patterns"  href="https://redhat.com" ></a>
</footer><script src="../_/js/vendor/clipboard.js"></script>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
